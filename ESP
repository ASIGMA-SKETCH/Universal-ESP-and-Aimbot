local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- Function to check if two players are on the same team
local function IsTeammate(targetPlayer)
    if LocalPlayer.Team and targetPlayer.Team then
        return LocalPlayer.Team == targetPlayer.Team
    end
    return false
end

-- Function to add ESP to a player
local function AddESP(player)
    -- Don't highlight yourself or teammates
    if player == LocalPlayer or IsTeammate(player) then return end

    -- Wait for character to load
    player.CharacterAdded:Connect(function(character)
        local highlight = Instance.new("Highlight")
        highlight.Parent = character
        highlight.FillColor = Color3.fromRGB(255, 100, 0) -- Reddish-orange
        highlight.FillTransparency = 0.5 -- Semi-transparent
        highlight.OutlineColor = Color3.fromRGB(255, 50, 0) -- Darker outline
        highlight.OutlineTransparency = 0.2
    end)

    -- If they already have a character, apply ESP immediately
    if player.Character then
        local highlight = Instance.new("Highlight")
        highlight.Parent = player.Character
        highlight.FillColor = Color3.fromRGB(255, 100, 0)
        highlight.FillTransparency = 0.5
        highlight.OutlineColor = Color3.fromRGB(255, 50, 0)
        highlight.OutlineTransparency = 0.2
    end
end

-- Apply ESP to all current and future players
for _, player in pairs(Players:GetPlayers()) do
    AddESP(player)
end

Players.PlayerAdded:Connect(AddESP)
